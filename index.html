<!doctype html>
<html>
   <head>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>MediBot</title>
	  <style>
		body{
			margin: 0 auto;
			width: 100%;
		}
		
		#chatbox{
			position: relative;
			margin: 0 auto;
			width: 750px;
			min-width: 750px;
			height: 630px;
			min-height: 630px;
		}
		
		#chatbox .wc-card, #chatbox .wc-adaptive-card{
			width: 538px!important;
			min-width: 538px!important;
		}
		
		#chatbox iframe{
			height: 100%;
			width: 100%;
		}
		
	  </style>
	  <script src="/socket.io/socket.io.js"></script>
	  <script>
	    var socket = io.connect('http://localhost');//path to socket.io
		socket.emit('getUserLocation', (function(){
			'use strict';
			var noGeolocation = function() {
				alert("For some reason we are unable to find your location. Sorry.");
			};
			
			if(!navigator.geolocation || !document.querySelector){
				noGeolocation();
			}
			else{
				navigator.geolocation.getCurrentPosition(
					function(p){
						var latitude = p.coords.latitude;
						var longitude = p.coords.longitude;
//						document.querySelector("[TYPE='submit']").removeAttribute("disabled");
						alert('Clientside alert: Lat=' + latitude + '&Long=' + longitude);
						var http = new XMLHttpRequest();
						var url = "/location";
						var params = "lat=" + p.coords.latitude + "&lng=" + p.coords.longitude;
						http.open("POST", url, true);
						
						//Send the proper header information along with the request
						http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					//	http.setRequestHeader("Content-length", params.length);
					//	http.setRequestHeader("Connection", "close");

						http.onreadystatechange = function() {//Call a function when the state changes.
							if(http.readyState == 4 && http.status == 200) {
								alert(http.responseText);
							}
						}
						http.send(params);
						
					},
					function(err) {
						noGeolocation();
					}
				);
			}
		})();
		);
	  </script>
	  <script>
		(function(){
			'use strict';
			var noGeolocation = function() {
				alert("For some reason we are unable to find your location. Sorry.");
			};
			
			if(!navigator.geolocation || !document.querySelector){
				noGeolocation();
			}
			else{
				navigator.geolocation.getCurrentPosition(
					function(p){
						var latitude = p.coords.latitude;
						var longitude = p.coords.longitude;
//						document.querySelector("[TYPE='submit']").removeAttribute("disabled");
						alert('Clientside alert: Lat=' + latitude + '&Long=' + longitude);
						var http = new XMLHttpRequest();
						var url = "/location";
						var params = "lat=" + p.coords.latitude + "&lng=" + p.coords.longitude;
						http.open("POST", url, true);
						
						//Send the proper header information along with the request
						http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
					//	http.setRequestHeader("Content-length", params.length);
					//	http.setRequestHeader("Connection", "close");

						http.onreadystatechange = function() {//Call a function when the state changes.
							if(http.readyState == 4 && http.status == 200) {
								alert(http.responseText);
							}
						}
						http.send(params);
						
					},
					function(err) {
						noGeolocation();
					}
				);
			}
		})();
	  </script>

   </head>
   <body>
	<div id="chatbox">
		<iframe src='https://webchat.botframework.com/embed/Medibot_medibuddy?s=p8CLqYqBMz0.cwA.HQg.w4odFNI4CdHeHNxNmp2xjF-OYQH9L9w0qxtBMHjjBxQ'></iframe>
	</div>
	</body>
</html>